<!-- /bag/templates/bag/bag.html -->
<h1>Your Shopping Bag</h1>

{% if items %}
<table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Size</th>
      <th>Accessories</th>
      <th>Qty</th>
      <th>Subtotal</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.product.name }}</td>
      <td>{{ item.variant.size }}</td>
      <td>
        {% for a in item.accessories %}
          {{ a.name }}{% if not forloop.last %}, {% endif %}
        {% empty %}None
        {% endfor %}
      </td>
      <td>
        <form method="post" action="/bag/update/{{ item.key }}/">
          {% csrf_token %}
          <input type="number" name="quantity" value="{{ item.quantity }}" min="1">
          <button type="submit">Update</button>
        </form>
      </td>
      <td>${{ item.subtotal|floatformat:2 }}</td>
      <td>
        <form method="post" action="/bag/remove/{{ item.key }}/">
          {% csrf_token %}
          <button type="submit">Remove</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<h3>Total: ${{ total|floatformat:2 }}</h3>
{% else %}
<p>Your bag is empty.</p>
{% endif %}

<a href="/products/">Continue Shopping</a>
<a href="/checkout/">Proceed to Checkout</a>
